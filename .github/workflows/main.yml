name: Deploy to Hosting Ukraine
on:
  pull_request:
    branches: [ master ]
  push:
    branches: [ master ]
  schedule:
    - cron:  '15 0 * * *'

jobs:
  build:
    runs-on: self-hosted

    steps:
    - uses: actions/checkout@v2
      
    - name: send the start buid message 
      uses: appleboy/telegram-action@master
      with:
       to: ${{ secrets.TELEGRAM_CHAT_ID }}
       token: ${{ secrets.TELEGRAM_TOKEN }}
       args: –û–±–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–∞–π—Ç—É —Å—Ç–∞—Ä—Ç–æ–Ω—É–ª–æ‚è≥ –ó–∞–≤–∞—Ä—é–π —á–∞–π —Ç–∞ —Ç—Ä–µ–º—Ç–∏, —â–æ–± –≤—Å–µ –±—É–ª–æ —É—Å–ø—ñ—à–Ω–æü•∏‚òïÔ∏è [${{ github.event_name }}]
      
    - name: Install packages
      run: yarn install --force
    
    - name: Send install fail notificatin
      if: ${{ failure() }}
      uses: appleboy/telegram-action@master
      with:
        to: ${{ secrets.TELEGRAM_CHAT_ID }}
        token: ${{ secrets.TELEGRAM_TOKEN }}
        args: –ü–æ–º–∏–ª–∫–∞! –°–∫—Ä—ñ–ø—Ç–∏ —Å–∞–π—Ç—É –Ω–µ —Å–∫–∞—á–∞–ª–∏—Å—å. –î–µ –¥–æ–∫—Ç–æ—Ä, –í–∞—Å—è üíäüëÄ
    - name: Build gatsby
      run: yarn build
      env:
          CONTENTFUL_SPACE_ID: ${{secrets.CONTENTFUL_SPACE_ID}}
          CONTENTFUL_SPACE_TOKEN: ${{secrets.CONTENTFUL_SPACE_TOKEN}}

    - name: Send build fail notificatin
      if: ${{ failure() }}
      uses: appleboy/telegram-action@master
      with:
        to: ${{ secrets.TELEGRAM_CHAT_ID }}
        token: ${{ secrets.TELEGRAM_TOKEN }}
        args: –ü–æ–º–∏–ª–∫–∞! –°–∫—Ä—ñ–ø—Ç–∏ —Å–∞–π—Ç—É –Ω–µ –∑–±—É–¥—É–≤–∞–ª–∏—Å—è. –®–æ —Ä–æ–±–∏—Ç—å, –í–∞—Å—è üòµüëÄ
      
    - name: Change Directory
      run: cd ..
      
    - name: Upload to FTP
      run: echo -e "put -R public\nrm -rf www_tmp\nrename www www_tmp\nrename public www\nrm -rf www_tmp" | ncftp -u ${{secrets.FTP_USER}} -p ${{secrets.FTP_PASSWORD}} sashagol.ftp.tools
      
    - name: send the end build message 
      uses: appleboy/telegram-action@master
      with:
       to: ${{ secrets.TELEGRAM_CHAT_ID }}
       token: ${{ secrets.TELEGRAM_TOKEN }}
       args: –£—Å–ø—ñ—à–Ω–æüéÜ –ú–æ–∂–Ω–∞ –∑—ñ—Ç—Ö–Ω—É—Ç–∏ —Å–ø–æ–∫—ñ–π–Ω–æ, –∑‚Äô—ó—Å—Ç–∏ —â–µ —Ü–∏—Ö –º‚Äô—è–∫–∏—Ö —Ñ—Ä–∞–Ω—Ü—É–∑—å–∫–∏—Ö –±—É–ª–æ–∫ —Ç–∞ –≤–∏–ø–∏—Ç–∏ —á–∞—é.‚òï
